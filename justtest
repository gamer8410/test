--[[
  MINIMAL CLEAN FARM SCRIPT (FIXED)
  UI: UiRedzHub.lua (TBoyRoblox727)

  FEATURES:
   - Auto Farm toggle
   - Weapon Type dropdown (Melee / Sword)
   - Auto equip selected type
   - Attack nearest enemy

  NOTHING ELSE.
]]

--// SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer

--// GLOBAL STATE
_G.AutoFarm = false
_G.WeaponType = "Melee" -- "Melee" | "Sword"

--// LOAD REDZ HUB UI (IMPORTANT: DO NOT ASSIGN RETURN)
loadstring(game:HttpGet(
    "https://raw.githubusercontent.com/TBoyRoblox727/Ui/refs/heads/main/UiRedzHub.lua"
))()

-- Menu is created globally by the UI
local Window = Menu:CreateWindow({
    Title = "Clean Farm",
    SubTitle = "Minimal"
})

local FarmTab = Window:CreateTab("Farm")

FarmTab:CreateToggle({
    Name = "Auto Farm",
    Default = false,
    Callback = function(v)
        _G.AutoFarm = v
    end
})

FarmTab:CreateDropdown({
    Name = "Weapon Type",
    Options = {"Melee", "Sword"},
    Default = "Melee",
    Callback = function(v)
        _G.WeaponType = v
    end
})

--// WEAPON HELPERS
local function getCharacter()
    return player.Character or player.CharacterAdded:Wait()
end

local function equipWeaponByType()
    local character = getCharacter()
    local backpack = player.Backpack

    -- already holding correct type
    for _,tool in pairs(character:GetChildren()) do
        if tool:IsA("Tool") and tool.ToolTip == _G.WeaponType then
            return
        end
    end

    -- equip from backpack
    for _,tool in pairs(backpack:GetChildren()) do
        if tool:IsA("Tool") and tool.ToolTip == _G.WeaponType then
            tool.Parent = character
            return
        end
    end
end

--// FIND NEAREST ENEMY
local function getNearestEnemy(hrp)
    local closest, dist = nil, math.huge
    for _,mob in pairs(Workspace.Enemies:GetChildren()) do
        if mob:FindFirstChild("HumanoidRootPart") and mob:FindFirstChild("Humanoid") then
            if mob.Humanoid.Health > 0 then
                local d = (mob.HumanoidRootPart.Position - hrp.Position).Magnitude
                if d < dist then
                    closest = mob
                    dist = d
                end
            end
        end
    end
    return closest
end

--// MAIN LOOP
RunService.Heartbeat:Connect(function()
    if not _G.AutoFarm then return end

    local character = player.Character
    if not character then return end

    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    equipWeaponByType()

    local enemy = getNearestEnemy(hrp)
    if enemy then
        hrp.CFrame = enemy.HumanoidRootPart.CFrame * CFrame.new(0, 8, 0)
    end
end)

--// END
