--[[
  MINIMAL CLEAN FARM SCRIPT
  UI: Redz Hub (UiRedzHub.lua)
  ONLY:
   - Auto Farm Toggle
   - Weapon Selector
  Nothing else.
]]

--// SERVICES
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

--// REMOTE
local CommF = ReplicatedStorage.Remotes.CommF_

--// STATE
_G.AutoFarm = false
_G.SelectedWeapon = nil

--// REDZ HUB UI (WORKING COMMUNITY VERSION)
local RedzUI = loadstring(game:HttpGet(
    "https://raw.githubusercontent.com/TBoyRoblox727/Ui/refs/heads/main/UiRedzHub.lua"
))()

local Window = RedzUI:MakeWindow({
    Title = "Clean Farm",
    SubTitle = "Minimal",
    SaveFolder = "CleanFarm"
})

local FarmTab = Window:MakeTab({Name = "Farm"})

FarmTab:AddToggle({
    Name = "Auto Farm",
    Default = false,
    Callback = function(v)
        _G.AutoFarm = v
    end
})

FarmTab:AddDropdown({
    Name = "Weapon",
    Options = {},
    Callback = function(v)
        _G.SelectedWeapon = v
    end
})

--// WEAPON HANDLING
local function refreshWeapons()
    local list = {}
    for _,tool in pairs(player.Backpack:GetChildren()) do
        if tool:IsA("Tool") then
            table.insert(list, tool.Name)
        end
    end
    FarmTab:UpdateDropdown("Weapon", list)
end

local function equipWeapon()
    if not _G.SelectedWeapon then return end
    local tool = player.Backpack:FindFirstChild(_G.SelectedWeapon)
        or character:FindFirstChild(_G.SelectedWeapon)
    if tool and tool.Parent ~= character then
        tool.Parent = character
    end
end

player.Backpack.ChildAdded:Connect(refreshWeapons)
player.Backpack.ChildRemoved:Connect(refreshWeapons)
refreshWeapons()

--// BASIC FARM LOOP (NO QUEST LOGIC)
RunService.Heartbeat:Connect(function()
    character = player.Character or character
    hrp = character:FindFirstChild("HumanoidRootPart") or hrp

    if not _G.AutoFarm then return end

    equipWeapon()

    -- Just target nearest enemy (simple & safe)
    local closest, dist = nil, math.huge
    for _,e in pairs(Workspace.Enemies:GetChildren()) do
        if e:FindFirstChild("HumanoidRootPart") and e:FindFirstChild("Humanoid") and e.Humanoid.Health > 0 then
            local d = (e.HumanoidRootPart.Position - hrp.Position).Magnitude
            if d < dist then
                closest, dist = e, d
            end
        end
    end

    if closest then
        hrp.CFrame = closest.HumanoidRootPart.CFrame * CFrame.new(0, 10, 0)
    end
end)

--// END
